#!/bin/bash
set -eux

success() {
  echo -e "\xe2\x9c\x93 $1" >&2
}

failure() {
  echo -e "\xe2\x9c\x97 $1" >&2
  exit 1
}

nacl() {
    valgrind -q ../nacl.debug $@
}

rm -rf testdir
mkdir testdir
pushd testdir
echo "Testing box..."
nacl box keypair -p p1 -s s1
nacl box keypair -p p2 -s s2
echo 'attack at dawn' >m1
nacl box make -p p2 -s s1 -m m1 -c c
nacl box open -p p1 -s s2 -c c -m m2
cmp --silent m1 m2 || failure "m1 and m2 differ"
popd

